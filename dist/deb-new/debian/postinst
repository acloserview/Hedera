#!/bin/sh
## fixme!
# - use symlinks instead of placing files everywhere
LANG=C
set -e
_tmpdir=/tmp

func_clean() {
if [ -d "${_tmpdir}"/Hedera-master ]; then
	rm -rf "${_tmpdir}"/Hedera-master
fi
}

func_checks() {
if [ ! -d /usr/share/themes ];then
    printf "/usr isn't your default prefix - aborting!\n"
    exit 1
fi
}

func_download() {
	printf '\n==> Downloading the latest release from GitHub!\n'
    _downloaderhelpers="curl wget svn git"
    for _downloaderhelper in $_downloaderhelpers; do
        type $_downloaderhelper &>/dev/null && _downloader=$_gui 
    done
	case $_downloaderhelper in
		git)
			git clone https://github.com/sixsixfive/Hedera.git "${_tmpdir}"/Hedera-master;;
		svn)
			svn co https://github.com/sixsixfive/Hedera/trunk "${_tmpdir}"/Hedera-master;;
		wget|curl)
			if ($type 7z >/dev/null 2>&1); then
				_unzip=7z;;
			elif ($type unzip >/dev/null 2>&1); then
				_unzip=unzip;;
			else
				printf "\nYou either need 7z or unzip - Aborting!.\n"
				exit 1
			fi
			case $_downloaderhelper in
				wget)
					wget https://github.com/sixsixfive/Hedera/archive/master.zip -O "${_tmpdir}"/Hedera-master.zip;;
				curl)
					curl -L https://github.com/sixsixfive/Hedera/archive/master.zip > "${_tmpdir}"/Hedera-master.zip;;
			esac
			printf '\n==> Extracting...\n'
			cd "${_tmpdir}"
			if ($type 7z >/dev/null 2>&1); then
				7z x "${_tmpdir}"/Hedera-master.zip -o"${_tmpdir}"
			else ($type unzip >/dev/null 2>&1); then
				unzip Hedera-master.zip -d "${_tmpdir}"
			fi;;
	esac
	if [ -f "${_tmpdir}"/Hedera-master/CP_TO_DATADIRS/themes/Hedera/gtk-3.20/gtk.css ]; then
		if [ -f Hedera-master.zip ]; then
			rm -f "${_tmpdir}"/Hedera-master.zip
		fi
	else
		printf "\nfailed to extract\n"
		exit 1
	fi
}

func_instdata() {
	_gtk3version=$(dpkg-query -W libgtk-3-0|cut -f2|sed 's/\.[^.]*$//')
	ln -s $_gtk3version "${_tmpdir}"/Hedera-master/CP_TO_DATADIRS/themes/Hedera/gtk-3.0
	cd "${_tmpdir}"/Hedera-master/CP_TO_DATADIRS/
	mkdir -p "${_tmpdir}"/Hedera-master/CP_TO_DATADIRS/Hedera-theme
	find . -not -type d|sed 's#^./#/usr/share/#' >>"${_tmpdir}"/Hedera-master/CP_TO_DATADIRS/Hedera-theme/files
}

func_distroicon() {
	cd /usr/share/icons/Hedera
	if [ $(cat /etc/os-release|grep "^ID=debian$") ];then
		if dpkg --get-selections|grep siduction &>/dev/null;then
			_distributor="siduction"
		else
			_distributor="debian"
		fi
	elif [ $(cat /etc/os-release|grep "^ID=devuan$") ];then
		_distributor="devuan"
	elif [ $(cat /etc/os-release|grep "^ID=opensuse$") ];then
		_distributor="suse"
	fi
	if [ -f 48/logos/distributor-$_distributor.png ];then
		for _dir in $(echo $(find -maxdepth 1 -mindepth 1 -type d));do
			cd $_dir
			cp -fv logos/distributor-$_distributor.png logos/emblem-distributor.png
			cd ..
		done
	fi
}
auto_distroicon
cat <<\EOF














████████▄   ▄██████▄  ███▄▄▄▄      ▄████████  ██████
███   ▀███ ███    ███ ███▀▀▀██▄   ███    ███  ██████
███    ███ ███    ███ ███   ███   ███    █▀   ██████
███    ███ ███    ███ ███   ███  ▄███▄▄▄      ██████
███    ███ ███    ███ ███   ███ ▀▀███▀▀▀      ██████
███    ███ ███    ███ ███   ███   ███    █▄   
███   ▄███ ███    ███ ███   ███   ███    ███   ████
████████▀   ▀██████▀   ▀█   █▀    ██████████   ████



EOF
exit 0 
